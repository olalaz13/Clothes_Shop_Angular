<!-- Page header -->
<section class="grid-wrap">
    <nav aria-label="breadcrumb" class="breadcrumb">
        <a [routerLink]="['/']">Home</a>
        <span>/</span>
        <span>Shop</span>
    </nav>
    <div class="shop-banner">
        <div class="shop-banner-content">
            <h1 class="shop-title">Shop Collection</h1>
            <p class="shop-subtitle">Kh√°m ph√° b·ªô s∆∞u t·∫≠p ƒë·ªôc ƒë√°o, l·ªçc theo s·ªü th√≠ch v√† t√¨m phong c√°ch c·ªßa ri√™ng b·∫°n</p>
            <div class="shop-stats">
                <div class="stat-item">
                    <span class="stat-number">{{ getProductCount() }}</span>
                    <span class="stat-label">S·∫£n ph·∫©m</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ categories.length - 1 }}</span>
                    <span class="stat-label">Danh m·ª•c</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">‚≠ê 4.9</span>
                    <span class="stat-label">ƒê√°nh gi√°</span>
                </div>
            </div>
        </div>
        <div class="shop-banner-image">
            <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&w=1200&q=80"
                alt="Fashion Collection" />
            <div class="banner-overlay"></div>
            <div class="floating-badge"><span>üõçÔ∏è New Arrivals</span></div>
        </div>
    </div>
</section>

<!-- Main Grid -->
<main class="grid-wrap">
    <div class="shop-layout">
        <aside class="shop-sidebar" [class.open]="isSidebarOpen">
            <h3 style="margin-top:0">Filters</h3>
            <div class="filter-block">
                <div class="muted" style="margin-bottom:6px">Categories</div>
                <div class="cats" id="categories">
                    <button *ngFor="let category of categories" class="chip"
                        [class.active]="category.name===activeCategory"
                        (click)="onCategoryChange(category.name)">{{category.name}}</button>
                </div>
            </div>
            <div class="filter-block">
                <div class="muted" style="margin-bottom:6px">Price:</div>
                <div class="row" style="gap:8px">
                    <input id="priceMin" type="number" placeholder="Min" [(ngModel)]="priceMin" />
                    <span class="muted">-</span>
                    <input id="priceMax" type="number" placeholder="Max" [(ngModel)]="priceMax" />
                </div>
                <button id="applyPrice" class="btn" style="margin-top:8px;width:100%"
                    (click)="onApplyPrice()">Apply</button>
            </div>
            <div class="filter-block">
                <div class="muted" style="margin-bottom:6px">View</div>
                <div class="row" style="gap:6px">
                    <button id="viewGrid" class="btn" title="Grid" style="flex:1" (click)="setViewGrid()">‚ñ¶</button>
                    <button id="viewList" class="btn" title="List" style="flex:1" (click)="setViewList()">‚â£</button>
                </div>
            </div>
        </aside>
        <section class="shop-content">
            <div class="shop-toolbar">
                <div class="row" style="gap:8px">
                    <div><strong>All products</strong> <span class="muted" id="countTxt"> ‚Äî {{ getProductCount() }}
                            items</span></div>
                </div>
                <div class="row" style="gap:8px">
                    <div class="muted">Sort</div>
                    <select id="sort" [(ngModel)]="sortBy" (change)="onSortChange()">
                        <option value="popular">Most popular</option>
                        <option value="asc">Price: low ‚Üí high</option>
                        <option value="desc">Price: high ‚Üí low</option>
                    </select>
                </div>
            </div>

            <div class="grid" id="grid" [class.list-view]="viewMode==='list'" [class.grid-view]="viewMode==='grid'">
                <div class="card" *ngFor="let product of paginatedProducts">
                    <div class="thumb" [style.backgroundImage]="'url(' + getImgUrl(product.img) + ')'" role="img"
                        [attr.aria-label]="product.title" [routerLink]="['/product', product._id]"></div>
                    <div>
                        <div style="display:flex;justify-content:space-between;align-items:center">
                            <div>
                                <div style="font-weight:700; cursor: pointer;" [routerLink]="['/product', product._id]">
                                    {{product.title}}</div>
                                <div class="muted" style="font-size:13px">{{product.cat}}</div>
                            </div>
                            <div class="price">${{product.price}}</div>
                        </div>
                        <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
                            <div class="muted" style="font-size:13px">Quick view for details</div>
                            <div class="actions" style="display: flex; gap: 8px; align-items: center;">
                                <button class="fav-icon-btn" (click)="toggleFavorite(product)"
                                    [class.active]="isFavorite(product)"
                                    style="background: none; border: none; font-size: 1.2rem; cursor: pointer; color: #ccc; transition: color 0.3s;">
                                    <i class="bi" [class.bi-heart-fill]="isFavorite(product)"
                                        [class.bi-heart]="!isFavorite(product)"
                                        [style.color]="isFavorite(product) ? '#ff6b6b' : '#ccc'"></i>
                                </button>
                                <button class="outline" (click)="quickView(product)">Quick view</button>
                                <button class="add" style="background-color: #ff6b6b"
                                    (click)="addToCart(product)">Add</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <nav aria-label="Page navigation" *ngIf="totalPages > 1">
                <ul class="pagination justify-content-center">
                    <li class="page-item" [class.disabled]="currentPage === 1">
                        <a class="page-link" (click)="$event.preventDefault(); setPage(currentPage - 1)"
                            style="cursor: pointer;">&laquo;</a>
                    </li>
                    <li class="page-item" *ngFor="let p of pageNumbers" [class.active]="p === currentPage">
                        <a class="page-link" (click)="$event.preventDefault(); setPage(p)" style="cursor: pointer;">{{ p
                            }}</a>
                    </li>
                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                        <a class="page-link" (click)="$event.preventDefault(); setPage(currentPage + 1)"
                            style="cursor: pointer;">&raquo;</a>
                    </li>
                </ul>
            </nav>

            <!-- Quick view modal -->
            <div class="modal open" id="modal" *ngIf="selectedProduct">
                <div class="modal-card">
                    <div>
                        <div class="m-thumb" id="mThumb"
                            [style.backgroundImage]="'url(' + getImgUrl(selectedProduct.img) + ')'">
                        </div>
                    </div>
                    <div>
                        <div style="display:flex;justify-content:space-between;align-items:start;">
                            <div>
                                <h2 id="mTitle" style="margin:0">{{selectedProduct.title}}</h2>
                                <div class="muted" id="mCat">{{selectedProduct.cat}}</div>
                            </div>
                            <div><button class="close-btn" (click)="closeModal()">‚úï</button></div>
                        </div>
                        <div style="margin-top:12px">
                            <div id="mPrice" style="font-weight:800;font-size:20px">${{selectedProduct.price}}</div>
                            <p id="mDesc" class="muted">{{selectedProduct.desc}}</p>
                        </div>
                        <div class="modal-option" style="margin-top:18px;display:flex;gap:8px">
                            <div class="dropdown" id="sizeDropdown">
                                <select id="sizeSelect" class="form-select">
                                    <option>Size S</option>
                                    <option>Size M</option>
                                    <option>Size L</option>
                                </select>
                            </div>
                            <button class="add" style="background-color: #ff6b6b;"
                                (click)="addToCart(selectedProduct)">Add to cart</button>
                            <button class="outline" id="favBtn" (click)="toggleFavorite(selectedProduct)"
                                [class.active]="isFavorite(selectedProduct)">
                                <i class="bi" [class.bi-heart-fill]="isFavorite(selectedProduct)"
                                    [class.bi-heart]="!isFavorite(selectedProduct)"
                                    [style.color]="isFavorite(selectedProduct) ? '#ff6b6b' : 'inherit'"></i>
                                {{ isFavorite(selectedProduct) ? ' Favorited' : ' Favorite' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>
<!-- filters -->
<div id="filtersOverlay" class="overlay" (click)="closeSidebar()" [class.show]="isSidebarOpen"></div>
<button id="toggleFilters" class="btn btn-primary show-on-mobile" style="background-color: rgb(72, 72, 253);"
    title="Filters" (click)="toggleFilters()">Filters</button>